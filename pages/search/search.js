(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/search/search"],{"0cb6":function(e,o,t){"use strict";var i=t("71d8"),a=t.n(i);a.a},"521b":function(e,o,t){"use strict";t.r(o);var i=t("55bd"),a=t.n(i);for(var r in i)"default"!==r&&function(e){t.d(o,e,(function(){return i[e]}))}(r);o["default"]=a.a},"55bd":function(e,o,t){"use strict";(function(e){Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var i=function(){t.e("components/uni-popup/uni-popup").then(function(){return resolve(t("276e"))}.bind(null,t)).catch(t.oe)},a=function(){t.e("components/myPopup").then(function(){return resolve(t("5673"))}.bind(null,t)).catch(t.oe)},r=function(){t.e("components/share").then(function(){return resolve(t("ab53"))}.bind(null,t)).catch(t.oe)},n=e.getRecorderManager(),s=e.createInnerAudioContext();s.autoplay=!0;var d={components:{uniPopup:i,myPopup:a,share:r},data:function(){return{defaultKeyword:"",keyword:"",oldKeywordList:[],hotKeywordList:[],keywordList:[],forbid:"",isShowKeywordList:!1,imagePath:"",popupShow:!1,voicePath:"",startTiming:!1,drawTiming:!1,timeoutTiming:!1,animaTiming1:!1,animaTiming2:!1,animationData:{},maxTime:5e3,frame:50,possible:[],reference:null,results:[],imageResults:[{score:.944264,root:"商品-箱包",keyword:"手提袋"},{score:.799999,root:"Logo",keyword:"85度c"},{score:.589144,root:"商品-箱包",keyword:"购物袋"},{score:.227161,root:"商品-箱包",keyword:"塑料购物袋"},{score:.018175,root:"商品-箱包",keyword:"宣传袋"}],imagesResultShow:!1,replyWord:["很抱歉,识别精灵未能匹配到,将会尽快完善 ᕙ(⇀‸↼‵‵)ᕗ","未能匹配到结果,识别精灵会继续学习的, 试试其他的吧(๑°⌓°๑)","识别精灵成长中，正在学习该垃圾的分类","抱歉，识别精灵未能给您提供合适的结果","请尝试换一个搜索关键词试试看吧","很抱歉,识别精灵未能匹配到,将会尽快完善 ᕙ(⇀‸↼‵‵)ᕗ"],detailPopupShow:!1,detailShowObject:null}},onLoad:function(o){var t=this;if(1==o.type)t.takePhoto();else if(2==o.type)t.readyRecord();else if(3==o.type&&(console.log(" search-------"),console.log(o),o.keyword)){if(t.keyword=o.keyword,"null"!=o.uni){var i=JSON.parse(o.uni);t.detailPopupShow=!0,t.detailShowObject={keyword:i.garbageName,garbageType:i.garbageType,remark:i.remark},t.saveKeyword(i.garbageName)}if(console.log(o.keywordList),console.log("[]"==o.keywordList),"[]"!=o.keywordList){JSON.parse(o.keywordList);t.isShowKeywordList=!0,t.keywordList=t.drawCorrelativeKeyword(JSON.parse(o.keywordList),t.keyword)}console.log(t.isShowKeywordList),console.log(t.keywordList),console.log(t.detailPopupShow),0!=t.keywordList||t.detailPopupShow||t.noTitlemodalTap()}t.init(),console.log(1),n.onStop((function(o){e.showLoading({title:"正在努力识别中..."}),console.log("recorder stop"+JSON.stringify(o)),t.voicePath=o.tempFilePath,console.log(t.voicePath),t.popupShow=!1,e.uploadFile({url:t.serverUrl+"/upload/record",filePath:t.voicePath,name:"file",success:function(e){console.log(e.data);var o=JSON.parse(e.data),i=o.data,a=i.uni;t.keyword=i.keyword,t.isShowKeywordList=!0,t.keywordList=t.drawCorrelativeKeyword(i.results,t.keyword),a&&(t.detailPopupShow=!0,t.detailShowObject={keyword:a.garbageName,garbageType:a.garbageType,remark:a.remark}),0!=t.keywordList||t.detailPopupShow||t.noTitlemodalTap()},complete:function(){e.hideLoading()}})}))},methods:{tapKeyword:function(e){this.keyword=e,this.doSearch(),this.imagesResultShow=!1},noTitlemodalTap:function(){e.showModal({title:"未能匹配成功",content:this.replyWord[Math.round(5*Math.random())],confirmText:"知道了",showCancel:!1,success:function(e){e.confirm?console.log("用户点击确定"):e.cancel&&console.log("用户点击取消")}})},showDetail:function(e){this.detailShowObject=e,this.detailPopupShow=!0},hideMypopup:function(){this.detailPopupShow=!1},hideUnipPpup:function(){this.imagesResultShow=!1},readyRecord:function(){this.popupShow=!0},start:function(){this.recording()},end:function(){n.stop(),clearInterval(this.draw),clearTimeout(this.startTiming),clearTimeout(this.timeoutTiming),clearInterval(this.animaTiming1),clearInterval(this.animaTiming2),this.draw=!1,this.startTiming=!1,this.timeoutTiming=!1,this.animaTiming1=!1,this.animaTiming2=!1;var o=e.createAnimation({duration:500,timingFunction:"ease"});this.animation=o,o.scale(1,1).step(),this.animationData=o.export()},recording:function(){var o=this;n.start(),o.animaTiming1=setInterval((function(){var t=e.createAnimation({duration:500,timingFunction:"ease"});o.animation=t,t.scale(1.3,1.3).step(),o.animationData=t.export()}),500),o.animaTiming2=setInterval((function(){var t=e.createAnimation({duration:500,timingFunction:"ease"});o.animation=t,t.scale(1,1).step(),o.animationData=t.export()}),1e3),o.timeoutTiming=setTimeout((function(){clearInterval(o.draw),o.draw=!1,o.animaTiming1=!1,o.animaTiming2=!1,n.stop()}),o.maxTime)},playVoice:function(){var e=this;e.voicePath&&(s.src=e.voicePath,s.play())},hidePopup:function(){this.popupShow=!1},takePhoto:function(){var o=this;e.chooseImage({count:1,success:function(t){e.showLoading({title:"正在努力识别中..."}),o.imagePath=t.tempFilePaths[0],console.log(o.imagePath),e.uploadFile({url:o.serverUrl+"/upload/image",filePath:t.tempFilePaths[0],name:"file",success:function(e){console.log(e.data);var t=JSON.parse(e.data),i=t.data,a=JSON.parse(i.response);console.log(a.result);var r=i.uni;o.keyword=i.keyword,o.keywordList=o.drawCorrelativeKeyword(i.results,o.keyword),r?(o.isShowKeywordList=!0,o.detailPopupShow=!0,o.detailShowObject={keyword:r.garbageName,garbageType:r.garbageType,remark:r.remark}):o.keywordList.length>0?o.isShowKeywordList=!0:(o.imageResults=a.result,o.imagesResultShow=!0)},complete:function(){e.hideLoading()}})}})},init:function(){this.loadDefaultKeyword(),this.loadOldKeyword(),this.loadHotKeyword()},blur:function(){e.hideKeyboard()},loadDefaultKeyword:function(){this.defaultKeyword="苹果"},loadOldKeyword:function(){var o=this;e.getStorage({key:"OldKeys",success:function(e){var t=JSON.parse(e.data);o.oldKeywordList=t}})},loadHotKeyword:function(){var o=this;o.hotKeywordList=["键盘","鼠标","显示器","电脑主机","蓝牙音箱","笔记本电脑","鼠标垫","USB","USB3.0"],e.request({url:o.serverUrl+"/qb/top10",success:function(e){o.hotKeywordList=e.data.data.map((function(e){return e.keyword}))}})},inputChange:function(){var o=this,t=this.keyword;console.log("keyword:"+t),setTimeout((function(){if(console.log("results:"+t),!t)return o.keywordList=[],void(o.isShowKeywordList=!1);o.isShowKeywordList=!0,e.request({url:o.serverUrl+"/qb/name/"+t,success:function(e){console.log(e),o.keywordList=o.drawCorrelativeKeyword(e.data.data,t)}})}),300)},drawCorrelativeKeyword:function(e,o){for(var t=e.length,i=[],a=0;a<t;a++){var r=e[a],n=r.garbageName.replace(o,"<span style='color: #72c69c;'>"+o+"</span>");n="<div>"+n+"</div>";var s={keyword:r.garbageName,htmlStr:n,garbageType:r.garbageType,remark:r.remark};i.push(s)}return i},setkeyword:function(e){this.keyword=e.keyword},oldDelete:function(){var o=this;e.showModal({content:"确定清除历史搜索记录？",success:function(t){t.confirm?(console.log("用户点击确定"),o.oldKeywordList=[],e.removeStorage({key:"OldKeys"})):t.cancel&&console.log("用户点击取消")}})},hotToggle:function(){this.forbid=this.forbid?"":"_forbid"},doSearch:function(o){var t=this;e.showLoading({title:"正在努力查询中..."}),o=o||(this.keyword?this.keyword:this.defaultKeyword),this.keyword=o,this.saveKeyword(o),e.request({url:this.serverUrl+"/qb/uniname/"+this.keyword,success:function(e){console.log(e);var o=e.data.data,i=o.uni,a=o.results;i&&(t.detailPopupShow=!0,t.detailShowObject={keyword:i.garbageName,garbageType:i.garbageType,remark:i.remark}),a.length>0&&(t.keywordList=t.drawCorrelativeKeyword(a,t.keyword)),0!=t.keywordList||t.detailPopupShow||t.noTitlemodalTap()},complete:function(){e.hideLoading()}})},saveKeyword:function(o){var t=this;e.getStorage({key:"OldKeys",success:function(i){console.log(i.data);var a=JSON.parse(i.data),r=a.indexOf(o);-1==r?a.unshift(o):(a.splice(r,1),a.unshift(o)),a.length>10&&a.pop(),e.setStorage({key:"OldKeys",data:JSON.stringify(a)}),t.oldKeywordList=a},fail:function(i){var a=[o];e.setStorage({key:"OldKeys",data:JSON.stringify(a)}),t.oldKeywordList=a}})}}};o.default=d}).call(this,t("543d")["default"])},"5b25":function(e,o,t){"use strict";(function(e){t("d3fb"),t("921b");i(t("66fd"));var o=i(t("e20e"));function i(e){return e&&e.__esModule?e:{default:e}}e(o.default)}).call(this,t("543d")["createPage"])},"71d8":function(e,o,t){},"9eea":function(e,o,t){"use strict";var i={"uni-popup":function(){return t.e("components/uni-popup/uni-popup").then(t.bind(null,"276e"))}},a=function(){var e=this,o=e.$createElement,t=(e._self._c,e.__map(e.imageResults,(function(o,t){var i=Math.floor(100*o.score);return{$orig:e.__get_orig(o),g0:i}})));e.$mp.data=Object.assign({},{$root:{l0:t}})},r=[];t.d(o,"b",(function(){return a})),t.d(o,"c",(function(){return r})),t.d(o,"a",(function(){return i}))},e20e:function(e,o,t){"use strict";t.r(o);var i=t("9eea"),a=t("521b");for(var r in a)"default"!==r&&function(e){t.d(o,e,(function(){return a[e]}))}(r);t("0cb6");var n,s=t("f0c5"),d=Object(s["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],n);o["default"]=d.exports}},[["5b25","common/runtime","common/vendor"]]]);